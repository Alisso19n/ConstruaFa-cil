<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Painel do Cliente</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        :root{ --brand:#2c7be5; --brand2:#3498db; --danger:#e74c3c; --ink:#233142; --bg:#f3f8fe; --line:#e8eef7 }
        *{box-sizing:border-box}
        body{ font-family:Segoe UI, Arial, sans-serif; margin:0; background:var(--bg); color:var(--ink) }
        .wrap{ max-width:980px; margin:20px auto; padding:0 12px }
        h1{ color:var(--brand2); margin-bottom:10px }
        .toolbar{ display:flex; flex-wrap:wrap; gap:10px; margin:12px 0 16px }
        .btn{ padding:10px 14px; border-radius:10px; border:1px solid var(--line); background:#fff; cursor:pointer; text-decoration:none; color:var(--ink); font-weight:600 }
        .btn.primary{ background:var(--brand2); border-color:var(--brand2); color:#fff }
        .btn.alt{ background:#fff; border-color:var(--brand2); color:var(--brand2) }
        .btn.ghost{ background:#fff }
        .btn.danger{ background:var(--danger); border-color:var(--danger); color:#fff }
        .btn.sm{ padding:8px 12px; }
        .card{ background:#fff; border:1px solid var(--line); border-radius:12px; padding:14px; margin-bottom:16px }
        table{ width:100%; border-collapse:collapse; table-layout:fixed }
        th,td{ padding:10px; border-bottom:1px solid var(--line); text-align:left; vertical-align:top }
        th{ background:#eaf4ff; color:#245b8a }
        .badge{ display:inline-block; padding:4px 8px; border-radius:999px; font-size:.82rem; background:#eef6ff; border:1px solid #dfefff }
        .actions{ display:flex; flex-wrap:wrap; gap:8px }
        .pager{ display:flex; justify-content:center; gap:8px; margin:14px 0 }
        .pager a, .pager .badge{ padding:6px 10px; border:1px solid var(--line); border-radius:8px; text-decoration:none; color:var(--ink); background:#fff }
        .pager a.disabled{ pointer-events:none; opacity:.45 }
        .flash{ margin:10px 0; padding:10px 12px; border-radius:10px; border:1px solid #cfe3ff; background:#f3f9ff; color:#205081 }
    </style>
</head>
<body>
<div class="wrap">
    <h1 th:text="'Bem-vindo, ' + ${cliente.nome}">Painel do Cliente</h1>

    <!-- flashes simples via querystring -->
    <div class="flash" th:if="${param.ok}" th:text="${'A√ß√£o realizada: ' + param.ok[0]}"></div>

    <div class="toolbar">
        <a class="btn primary" th:href="@{/clientes/solicitar}">‚ûï Solicitar servi√ßo</a>
        <a class="btn alt" th:href="@{/clientes/editar}">‚úèÔ∏è Editar perfil</a>
        <form th:action="@{/clientes/excluir}" method="post" style="display:inline;"
              onsubmit="return confirmarExclusao();">
            <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <button type="submit" class="btn danger">üóëÔ∏è Excluir conta</button>
        </form>
        <span style="flex:1"></span>
        <a class="btn ghost" th:href="@{/}">üè† In√≠cio</a>
        <a class="btn ghost" th:href="@{/login}">üîê Login</a>
        <a class="btn ghost" th:href="@{/logout}">üö™ Sair</a>
    </div>

    <div class="card">
        <h3>Minhas Solicita√ß√µes</h3>
        <table>
            <thead>
            <tr>
                <th>Profissional</th>
                <th>Descri√ß√£o</th>
                <th>Data</th>
                <th>Status</th>
                <th style="width:210px;">A√ß√µes</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="s : ${solicitacoes.content}">
                <td th:text="${s.profissional != null ? s.profissional.nome : '-'}">Profissional</td>
                <td th:text="${s.descricao}">Descri√ß√£o</td>
                <td th:text="${#temporals.format(s.dataSolicitacao,'dd/MM/yyyy HH:mm')}">01/01/2025</td>
                <td><span class="badge" th:text="${s.status}">PENDENTE</span></td>
                <td>
                    <div class="actions" th:if="${s.status == null || #strings.equalsIgnoreCase(s.status,'PENDENTE')}">
                        <form th:action="@{|/clientes/solicitacoes/${s.id}/cancelar|}" method="post" style="display:inline;">
                            <input type="hidden" name="page" th:value="${solicitacoes.number}" />
                            <input type="hidden" name="size" th:value="${size}" />
                            <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                            <button type="submit" class="btn sm danger">Cancelar</button>
                        </form>
                    </div>
                    <div th:if="${s.status != null && !#strings.equalsIgnoreCase(s.status,'PENDENTE')}">
                        <em>Sem a√ß√µes.</em>
                    </div>
                </td>
            </tr>
            <tr th:if="${#lists.isEmpty(solicitacoes.content)}">
                <td colspan="5" style="text-align:center;">Nenhuma solicita√ß√£o encontrada.</td>
            </tr>
            </tbody>
        </table>

        <nav class="pager" th:if="${solicitacoes.totalPages > 1}">
            <a th:classappend="${solicitacoes.first} ? 'disabled'"
               th:href="@{/clientes/painel(page=${solicitacoes.number-1},size=${size})}">¬´ Anterior</a>
            <span class="badge">P√°gina <b th:text="${solicitacoes.number+1}">1</b> de <b th:text="${solicitacoes.totalPages}">1</b></span>
            <a th:classappend="${solicitacoes.last} ? 'disabled'"
               th:href="@{/clientes/painel(page=${solicitacoes.number+1},size=${size})}">Pr√≥ximo ¬ª</a>
        </nav>
    </div>
</div>

<script>
    function confirmarExclusao(){
      const p1 = confirm('Tem certeza que deseja excluir sua conta?');
      if(!p1) return false;
      return confirm('‚ö†Ô∏è Esta a√ß√£o √© irrevers√≠vel. Confirme novamente para excluir.');
    }
</script>
</body>
</html>
